terraform {
  backend "remote" {
    hostname     = "app.terraform.io"
    organization = "raven-coin"

    workspaces {
      name = "domain"
    }
  }

  required_providers {
    cloudflare = {
      source  = "cloudflare/cloudflare"
      version = "2.14.0"
    }
  }
}

locals {
  domain-ids = [
    # "cb01b4516b4c5d2998774aa887b0b99c", # ravencoin.org
    "0974ebf9d4d3724fc1ae86c2522d737a", # ravencoin.com
  ]

  seed-ips = [
    "3.127.151.245",
    "5.9.193.21",
    "5.39.65.109",
    "8.210.196.67",
    "13.229.251.59",
    "13.250.119.41",
    "18.157.163.113",
    "18.183.55.45",
    "18.191.225.66",
    "18.202.96.180",
    "18.202.105.221",
    "18.206.81.142",
    "34.78.47.232",
    "34.230.185.159",
    "34.248.13.29",
    "35.163.33.254",
    "35.163.74.172",
    "35.163.239.64",
    "35.166.222.70",
    "35.184.113.47",
    "35.194.13.205",
    "35.210.232.209",
    "39.105.17.199",
    "40.71.41.208",
    "42.190.219.130",
    "45.153.184.148",
    "47.99.181.77",
    "47.108.128.234",
    "47.108.140.186",
    "47.108.199.66",
    "47.114.128.14",
    "47.115.146.142",
    "47.115.147.131",
    "49.12.66.155",
    "49.247.9.201",
    "50.34.39.72",
    "51.77.53.207",
    "51.77.64.52",
    "51.89.96.116",
    "51.91.190.1",
    "52.37.42.247",
    "54.38.69.101",
    "54.165.12.117",
    "64.227.61.186",
    "66.42.56.30",
    "70.122.214.198",
    "83.149.99.129",
    "83.151.206.122",
    "83.243.191.199",
    "87.248.245.113",
    "91.121.108.41",
    "91.205.175.19",
    "95.179.180.160",
    "95.216.3.216",
    "95.216.142.160",
    "98.251.122.2",
    "109.90.2.70",
    "120.25.198.15",
    "134.122.1.178",
    "138.197.222.166",
    "138.207.64.80",
    "139.99.62.126",
    "139.162.69.95",
    "142.44.158.33",
    "145.239.0.123",
    "145.239.0.130",
    "145.239.0.161",
    "147.135.11.137",
    "155.138.155.222",
    "159.65.98.117",
    "167.99.137.231",
    "168.119.35.111",
    "173.249.19.207",
    "173.249.20.21",
    "180.150.58.89",
    "182.92.11.30",
    "185.203.114.222",
    "190.2.134.153",
    "192.99.16.198",
    "192.226.183.184",
    "198.199.77.83",
    "206.189.158.128",
    "208.72.56.214",
    "216.127.187.104",
    "221.148.123.67",
  ]
}

resource "cloudflare_record" "seed-nodes" {
  for_each = {
    for item in setproduct(local.domain-ids, local.seed-ips) :
    "${item[0]}-${item[1]}" => { zone : item[0], ip : item[1] }
  }
  name    = "seed-raven"
  zone_id = each.value.zone
  value   = each.value.ip
  type    = "A"
}
